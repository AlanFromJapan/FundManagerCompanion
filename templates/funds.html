{% extends 'base.html' %}

{% block title %}Funds List{% endblock %}

{% block content %}
<h2>Funds List ({{ pos | length }} funds)  </h2>


<table class="screensplit">
    <tbody>
        <tr>
            <td>
                <span class="total_positions">Total estimated position amount = {{ "{:,.0f}".format(stats['total_positions']) }} 円</span>
            </td>

            <td>
                <canvas id="fundsDonutChart" width="500" height="200"></canvas>
                <script>
                    //OceanBreeze palette from Coolors (thank you!)
                const palette = ['#03045E', '#0077B6', '#00B4D8', '#90E0EF', '#CAF0F8'];
                const ctx = document.getElementById('fundsDonutChart').getContext('2d');
                const zaChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ["{{ pos | map(attribute='name') | join('", "') | safe }}"],
                        datasets: [{
                            data: [{{ pos | map(attribute='latest_position')  | join(', ') | safe }}],
                            backgroundColor: palette,
                        }]
                    },
                    options: {
                        responsive: false,
                        legend: {
                            display: false
                        }
                    }
                });
                </script>
            </td>
        </tr>
    </tbody>
</table>

<table>
        <tr>
            <th>FundID</th>
            <th>Name</th>
            <th>Currency</th>
            <th>Current shares</th>
            <th>Current amount</th>
            <th>Latest NAV</th>
            <th>Latest NAV Date</th>
            <th class="tooltip">YtD Total Return%
                <span class="tooltiptext">Year-to-Date Total Return Percentage (NAV difference including received dividends)</span>
            </th>
        </tr>
    {% for p in pos %}
    <tr>
        <td>{{ p["fund_id"] }}</td>
        <td><a href="/funds/{{ p['fund_id'] }}">{{ p["name"] }}</a></td>
        <td>{{ p["currency"] }}</td>
        <td class="rightalign">{{ "{:,.0f}".format(p["latest_unit"]) }}</td>
        <td class="rightalign">{{ "{:,.0f}".format(p["latest_unit"] * p["latest_nav"] / 10000.0 ) }}&nbsp;円</td>
        <td class="rightalign">{{ "{:,.0f}".format(p["latest_nav"]) }}</td>
        <td class="rightalign">{{ p["latest_date_nav"][:10] }}</td>
        <td class="rightalign {{ 'stat_positive' if p['ytd_total_return'] > 0 else 'stat_negative' }}">{{ "{:+,.2f}%".format(p["ytd_total_return"]) }}</td>
    </tr>
    {% endfor %}
</table>
<details>
    <summary>Fund NAV refresh actions (click to unfold)</summary>
    <form method="post" action="/funds">
        <input type="hidden" name="update_nav" value="true">
        <input type="submit" value="Update ALL funds latest NAV">
    </form>
    <form method="post" action="/funds">
        <input type="hidden" name="update_history_nav" value="true">
        <input type="submit" value="Update ALL funds HISTORICAL NAV">
    </form>
    <form method="post" action="/funds">
        <input type="hidden" name="update_whole_nav" value="true">
        <input type="submit" value="Update ALL funds WHOLE NAV from Investment Trust Association">
    </form>
</details>
{% endblock %}

    
